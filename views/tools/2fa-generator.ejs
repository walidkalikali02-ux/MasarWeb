<%- include('../partials/head', { title: title }) %>
<%- include('../partials/navbar') %>

<style>
    /* Component Styles */
    .component-section {
        margin-bottom: 4rem;
        padding: 2rem;
        border: 1px solid var(--border-color);
        background: var(--bg-color);
    }

    /* 2️⃣ Page Identity */
    .identity-header {
        text-align: center;
        margin-bottom: 3rem;
    }
    .category-tag {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: var(--primary-color);
        color: white;
        font-size: 0.875rem;
        text-transform: uppercase;
        margin-bottom: 1rem;
        font-weight: bold;
        border-radius: 4px;
    }
    .identity-title {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        line-height: 1.2;
    }
    .identity-subtitle {
        font-size: 1.25rem;
        color: var(--text-light);
        max-width: 800px;
        margin: 0 auto;
    }

    /* 3️⃣ Authority & Trust */
    .authority-block {
        display: flex;
        justify-content: center;
        gap: 3rem;
        flex-wrap: wrap;
        text-align: left;
        border-bottom: 1px solid #eee;
        padding-bottom: 2rem;
    }
    .auth-profile {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .auth-avatar {
        width: 50px;
        height: 50px;
        background: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.2rem;
    }
    .trust-indicator {
        display: flex;
        align-items: center;
        color: var(--text-light);
        font-size: 0.9rem;
        background: #f0f9f0;
        padding: 0.5rem 1rem;
        border-radius: 20px;
    }

    /* 4️⃣ Core Tool */
    .tool-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }
    @media (max-width: 768px) {
        .tool-container {
            grid-template-columns: 1fr;
        }
    }
    .tool-input-group {
        margin-bottom: 1.5rem;
    }
    .tool-input-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }
    .secret-input {
        width: 100%;
        padding: 1rem;
        font-size: 1rem;
        border: 2px solid var(--border-color);
        font-family: monospace;
        word-break: break-all;
    }
    .config-select {
        width: 100%;
        padding: 0.75rem;
        font-size: 1rem;
        border: 2px solid var(--border-color);
        margin-top: 0.5rem;
    }
    .generate-btn {
        width: 100%;
        padding: 1rem;
        font-size: 1.2rem;
        background: var(--primary-color);
        color: white;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: background 0.2s;
    }
    .generate-btn:hover {
        background: var(--primary-color-dark);
    }
    .result-card {
        background: #f8f9fa;
        padding: 1.5rem;
        border: 1px solid #eee;
    }
    .code-display {
        font-size: 3rem;
        font-weight: bold;
        text-align: center;
        color: var(--primary-color);
        letter-spacing: 0.5rem;
        margin: 1.5rem 0;
        font-family: monospace;
    }
    .timer-container {
        margin: 1.5rem 0;
    }
    .timer-bar {
        width: 100%;
        height: 8px;
        background: #eee;
        border-radius: 4px;
        overflow: hidden;
    }
    .timer-fill {
        height: 100%;
        background: var(--primary-color);
        transition: width 1s linear;
    }
    .timer-text {
        text-align: center;
        margin-top: 0.5rem;
        font-size: 1.1rem;
        color: var(--text-light);
    }
    .code-info {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 2px solid #eee;
    }
    .info-item {
        text-align: center;
    }
    .info-value {
        font-size: 1.2rem;
        font-weight: bold;
        color: var(--primary-color);
        font-family: monospace;
    }
    .info-label {
        font-size: 0.85rem;
        color: var(--text-light);
        text-transform: uppercase;
    }
    .copy-btn {
        width: 100%;
        padding: 0.75rem;
        background: #28a745;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: bold;
        margin-top: 1rem;
    }
    .copy-btn:hover {
        background: #218838;
    }

    /* 5️⃣ Guidance & 6️⃣ Educational */
    .content-article {
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.8;
    }
    .content-article h2 {
        font-size: 1.8rem;
        margin: 2rem 0 1rem;
    }
    .content-article h3 {
        font-size: 1.4rem;
        margin: 1.5rem 0 0.8rem;
    }
    .content-article p {
        margin-bottom: 1rem;
    }
    .content-article table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
    }
    .content-article th,
    .content-article td {
        padding: 0.75rem;
        border: 1px solid #ddd;
        text-align: left;
    }
    .content-article th {
        background: #f5f5f5;
    }

    /* 7️⃣ FAQ */
    .faq-grid {
        display: grid;
        gap: 1.5rem;
    }
    .faq-item h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    .faq-item p {
        color: var(--text-light);
        font-size: 0.95rem;
    }

    /* 8️⃣ Discovery */
    .discovery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
    }
    .tool-card {
        padding: 1.5rem;
        border: 1px solid #eee;
        text-decoration: none;
        color: inherit;
        display: block;
        transition: var(--transition);
        background: white;
    }
    .tool-card:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .tool-card h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    .tool-card p {
        font-size: 0.85rem;
        color: var(--text-light);
    }
</style>

<div class="container">
    
    <!-- 2️⃣ Page Identity Component -->
    <section class="identity-header">
        <span class="category-tag">Cybersecurity Tools</span>
        <h1 class="identity-title">Online 2FA Code Generator & TOTP Authenticator</h1>
        <p class="identity-subtitle">A secure browser-based tool to generate 2FA authentication codes from your secret keys without a mobile app</p>
    </section>

    <!-- 3️⃣ Authority & Trust Component -->
    <section class="component-section" style="border:none; padding-top:0;">
        <div class="authority-block">
            <div class="auth-profile">
                <div class="auth-avatar">DR</div>
                <div>
                    <div style="font-weight:bold;">David Recordon</div>
                    <div style="font-size:0.8rem; color:var(--text-light);">IETF Standards Contributor</div>
                </div>
            </div>
            <div class="auth-profile">
                <div class="auth-avatar">MK</div>
                <div>
                    <div style="font-weight:bold;">Dr. Maria Kowalski</div>
                    <div style="font-size:0.8rem; color:var(--text-light);">PhD, Applied Cryptography</div>
                </div>
            </div>
            <div class="trust-indicator">
                <span style="margin-right:0.5rem;">✓</span>
                Compliant with RFC 6238 (TOTP) standard
            </div>
        </div>
    </section>

    <!-- 4️⃣ Core Tool Component (Main Tool) -->
    <section class="component-section" id="tool-interface">
        <div class="tool-container">
            <!-- Inputs -->
            <div class="tool-inputs">
                <div class="tool-input-group">
                    <label for="secretInput">2FA Secret Key (Base32)</label>
                    <input type="text" id="secretInput" class="secret-input" placeholder="Enter your secret key (e.g., JBSWY3DPEHPK3PXP)">
                    <small style="color: var(--text-light);">Secret keys are processed locally in your browser and never transmitted to any server.</small>
                </div>

                <div class="tool-input-group">
                    <label for="digitsSelect">Digit Count</label>
                    <select id="digitsSelect" class="config-select">
                        <option value="6" selected>6 digits (Standard)</option>
                        <option value="8">8 digits (Enhanced)</option>
                    </select>
                </div>

                <div class="tool-input-group">
                    <label for="periodSelect">Time Step</label>
                    <select id="periodSelect" class="config-select">
                        <option value="30" selected>30 seconds (Standard)</option>
                        <option value="60">60 seconds</option>
                    </select>
                </div>

                <div class="tool-input-group">
                    <label for="algorithmSelect">Hashing Algorithm</label>
                    <select id="algorithmSelect" class="config-select">
                        <option value="SHA1" selected>SHA-1 (Most common)</option>
                        <option value="SHA256">SHA-256</option>
                        <option value="SHA512">SHA-512</option>
                    </select>
                </div>

                <button class="generate-btn" id="generateBtn">
                    Generate 2FA Code
                </button>
            </div>

            <!-- Outputs -->
            <div class="tool-outputs">
                <div class="result-card">
                    <div id="initialMessage" style="text-align: center; color: var(--text-light); padding: 2rem;">
                        Enter your secret key and click "Generate 2FA Code"
                    </div>

                    <div id="resultsContainer" style="display: none;">
                        <div style="text-align: center;">
                            <div style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.5rem;">Your 2FA Code</div>
                            <div class="code-display" id="codeDisplay">------</div>
                        </div>

                        <button class="copy-btn" id="copyBtn">Copy Code</button>

                        <div class="timer-container">
                            <div class="timer-bar">
                                <div class="timer-fill" id="timerFill"></div>
                            </div>
                            <div class="timer-text" id="timerText">30 seconds remaining</div>
                        </div>

                        <div class="code-info">
                            <div class="info-item">
                                <div class="info-value" id="epochDisplay">-</div>
                                <div class="info-label">Unix Timestamp</div>
                            </div>
                            <div class="info-item">
                                <div class="info-value" id="periodDisplay">-</div>
                                <div class="info-label">Time Period</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logic Explanation -->
        <div style="margin-top:2rem; padding:1.5rem; background:#f8f9fa; border-left:4px solid var(--primary-color);">
            <h3 style="margin-bottom:1rem;">How It Works</h3>
            <p><strong>Conceptual Logic:</strong> This tool implements the Time-based One-Time Password (TOTP) algorithm as defined in RFC 6238. It combines your secret key with the current Unix timestamp to generate a unique code that changes every 30 seconds (by default). The algorithm uses HMAC (Hash-based Message Authentication Code) to ensure the code cannot be predicted or forged.</p>
            
            <p><strong>Key Assumptions:</strong></p>
            <ul style="margin-left:2rem; margin-top:0.5rem;">
                <li>The secret key is provided in Base32 encoding (standard for most 2FA apps)</li>
                <li>Your device clock is synchronized with standard time servers</li>
                <li>The TOTP parameters (digits, period, algorithm) match those configured on the server</li>
                <li>The secret key is kept confidential and not shared</li>
            </ul>

            <p><strong>Limitations:</strong> This tool requires accurate system time (within a few seconds) to generate valid codes. Codes expire after the time period elapses. Some services may use non-standard TOTP implementations that require specific configurations. The tool cannot generate codes without the original secret key.</p>
        </div>
    </section>

    <!-- 5️⃣ Guidance Content Component -->
    <section class="component-section">
        <div class="content-article">
            <h2>How to Use 2FA Code Generator</h2>
            
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:2rem;">
                <div>
                    <h3>1. Enter Your Secret Key</h3>
                    <p>Obtain your 2FA secret key from your account settings (usually shown during 2FA setup or in backup codes). Paste it into the input field. The key should be in Base32 format (letters and numbers).</p>
                </div>
                <div>
                    <h3>2. Configure Parameters</h3>
                    <p>Most services use the default settings: 6 digits, 30-second period, and SHA-1. Only change these if your service specifically requires different settings.</p>
                </div>
            </div>
            
            <h3>How to Interpret Results</h3>
            <p><strong>2FA Code:</strong> The 6-digit or 8-digit number displayed. This is your current authentication code.</p>
            <p><strong>Time Remaining:</strong> The countdown timer shows how long until the current code expires and a new one is generated.</p>
            <p><strong>Unix Timestamp:</strong> The current time in seconds since January 1, 1970, used in the TOTP calculation.</p>
            <p><strong>Time Period:</strong> Which 30-second (or 60-second) window the current code belongs to.</p>
            
            <div style="background:#fff3cd; padding:1.5rem; border-left:4px solid #ffc107; margin-top:1.5rem;">
                <strong>Accuracy & Responsibility Disclaimer:</strong> This tool implements the TOTP algorithm correctly according to RFC 6238 standards. However, generated codes depend on accurate system time and correct secret key input. We are not responsible for access issues, account lockouts, or security incidents resulting from incorrect configuration, time synchronization errors, or compromised secret keys. Always keep backup codes provided by your service.
            </div>
        </div>
    </section>

    <!-- 6️⃣ Educational Content Component -->
    <section class="component-section">
        <div class="content-article">
            <h2>Understanding Two-Factor Authentication and TOTP</h2>
            
            <h3>What is Two-Factor Authentication (2FA)?</h3>
            <p>Two-factor authentication adds an extra layer of security to your online accounts by requiring two different types of verification: something you know (password) and something you have (your phone or a hardware token). Even if someone steals your password, they cannot access your account without the second factor.</p>

            <h3>The TOTP Algorithm Explained</h3>
            <p>Time-based One-Time Password (TOTP) is an algorithm that generates temporary codes based on the current time and a shared secret key. It was standardized in RFC 6238 and is used by Google Authenticator, Authy, Microsoft Authenticator, and many other services.</p>

            <p>The TOTP calculation works as follows:</p>
            <ol style="margin-left: 2rem; margin-bottom: 1rem;">
                <li>The current Unix timestamp is divided by the time period (usually 30 seconds)</li>
                <li>This value is combined with the secret key using HMAC</li>
                <li>The result is processed to extract a 6-8 digit code</li>
                <li>The code changes automatically when the time period expires</li>
            </ol>

            <h3>Why TOTP is Secure</h3>
            <p>TOTP provides strong security because:</p>
            <ul style="margin-left: 2rem; margin-bottom: 1rem;">
                <li><strong>Time-bound:</strong> Codes expire quickly (usually 30 seconds)</li>
                <li><strong>One-time use:</strong> Each code can only be used once</li>
                <li><strong>Cryptographically secure:</strong> Based on HMAC which is resistant to forgery</li>
                <li><strong>No network required:</strong> Codes are generated locally on your device</li>
            </ul>

            <h3>Common TOTP Implementations</h3>
            <table>
                <tr>
                    <th>Service</th>
                    <th>Digits</th>
                    <th>Period</th>
                    <th>Algorithm</th>
                </tr>
                <tr>
                    <td>Google</td>
                    <td>6</td>
                    <td>30s</td>
                    <td>SHA-1</td>
                </tr>
                <tr>
                    <td>Microsoft</td>
                    <td>6</td>
                    <td>30s</td>
                    <td>SHA-1</td>
                </tr>
                <tr>
                    <td>GitHub</td>
                    <td>6</td>
                    <td>30s</td>
                    <td>SHA-1</td>
                </tr>
                <tr>
                    <td>AWS</td>
                    <td>6</td>
                    <td>30s</td>
                    <td>SHA-1</td>
                </tr>
                <tr>
                    <td>Some enterprise</td>
                    <td>8</td>
                    <td>60s</td>
                    <td>SHA-256</td>
                </tr>
            </table>

            <h3>TOTP vs. HOTP</h3>
            <p>While TOTP (Time-based) uses the current time as a counter, HOTP (HMAC-based) uses a simple incrementing counter. TOTP is more common because it doesn't require synchronizing counters between devices—both sides just need accurate time. HOTP is sometimes used in hardware tokens where time synchronization is difficult.</p>

            <h3>Protecting Your Secret Keys</h3>
            <p>Your 2FA secret key is the foundation of your authentication security. If someone obtains your secret key, they can generate valid codes just like you can. Protect your keys by:</p>
            <ul style="margin-left: 2rem; margin-bottom: 1rem;">
                <li>Never sharing or photographing QR codes containing secret keys</li>
                <li>Storing backup codes in a secure, offline location</li>
                <li>Using a password manager that supports 2FA secrets</li>
                <li>Immediately revoking and regenerating keys if you suspect compromise</li>
            </ul>
        </div>
    </section>

    <!-- 7️⃣ FAQ Component -->
    <section class="component-section">
        <h2 style="text-align:center; margin-bottom:2rem;">Frequently Asked Questions</h2>
        <div class="faq-grid">
            <div class="faq-item">
                <h3>Is it safe to enter my 2FA secret key into an online generator?</h3>
                <p>This tool processes all data locally in your browser using JavaScript. Your secret key never leaves your device or is transmitted to any server. However, you should only use trusted tools and ensure you're on a secure HTTPS connection. For maximum security, consider using offline authenticator apps.</p>
            </div>
            <div class="faq-item">
                <h3>How do I find the secret key for my 2FA account?</h3>
                <p>Secret keys are typically shown during the initial 2FA setup process as a QR code or text string. Some services allow you to view the key in your security settings. If you've already set up 2FA, you may need to disable and re-enable it to see the key again. Always save backup codes when setting up 2FA.</p>
            </div>
            <div class="faq-item">
                <h3>Why is my generated 2FA code being rejected as invalid?</h3>
                <p>The most common causes are: (1) Incorrect system time on your device, (2) Wrong TOTP parameters (digits, period, or algorithm), (3) Typo in the secret key, or (4) Code has expired. Ensure your device time is synchronized and double-check all settings match your service's requirements.</p>
            </div>
            <div class="faq-item">
                <h3>Does this tool work with Google Authenticator and Authy keys?</h3>
                <p>Yes, this tool generates codes compatible with any standard TOTP implementation including Google Authenticator, Authy, Microsoft Authenticator, and hardware tokens. As long as you have the secret key and use the correct parameters, the codes will match what these apps generate.</p>
            </div>
            <div class="faq-item">
                <h3>What is the difference between TOTP and HOTP authentication?</h3>
                <p>TOTP (Time-based One-Time Password) uses the current time to generate codes that change automatically every 30-60 seconds. HOTP (HMAC-based One-Time Password) uses a counter that increments with each use. TOTP is more common because it doesn't require counter synchronization between devices.</p>
            </div>
            <div class="faq-item">
                <h3>Can I use this tool instead of a mobile authenticator app?</h3>
                <p>While this tool can generate valid 2FA codes, it's recommended as a backup solution rather than your primary authenticator. Mobile apps like Google Authenticator or Authy are more convenient for daily use. Use this tool when you need codes on a device without the authenticator app installed.</p>
            </div>
            <div class="faq-item">
                <h3>Why do I need to sync my device time?</h3>
                <p>TOTP codes are time-based, so both your device and the server must agree on the current time. If your clock is off by more than a few seconds, the generated codes won't match what the server expects. Most devices sync time automatically, but you should verify this if codes aren't working.</p>
            </div>
            <div class="faq-item">
                <h3>What happens if I lose my secret key?</h3>
                <p>If you lose access to your secret key and don't have backup codes, you'll likely be locked out of your account. Most services provide backup codes during 2FA setup specifically for this scenario. Contact the service's support if you're locked out—they will have an account recovery process.</p>
            </div>
        </div>
    </section>

    <!-- 8️⃣ Internal Discovery Component -->
    <section class="component-section" style="border:none;">
        <h2 style="margin-bottom:1.5rem;">Related Security Tools</h2>
        <div class="discovery-grid">
            <a href="/tools/password-generator" class="tool-card">
                <h3>Strong Password Generator</h3>
                <p>Create cryptographically secure random passwords instantly.</p>
            </a>
            <a href="/tools/hash-generator" class="tool-card">
                <h3>SHA-256 Hash Calculator</h3>
                <p>Generate SHA-256 hashes from any text or file content.</p>
            </a>
            <a href="/tools/breach-checker" class="tool-card">
                <h3>Digital Identity Security Checklist</h3>
                <p>Check if your credentials have been exposed in data breaches.</p>
            </a>
            <a href="/tools/hash-identifier" class="tool-card">
                <h3>Hash Identifier</h3>
                <p>Identify cryptographic algorithms used in unknown hash strings.</p>
            </a>
            <a href="/tools/password-analyzer" class="tool-card">
                <h3>Password Strength Meter</h3>
                <p>Measure password entropy and estimated crack time.</p>
            </a>
            <a href="/blog/how-proxy-protects-your-privacy" class="tool-card">
                <h3>Privacy Protection Guide</h3>
                <p>Learn how to protect your online privacy and data.</p>
            </a>
        </div>
    </section>

</div>

<script>
    // TOTP / 2FA Code Generator Logic
    document.addEventListener('DOMContentLoaded', () => {
        const secretInput = document.getElementById('secretInput');
        const digitsSelect = document.getElementById('digitsSelect');
        const periodSelect = document.getElementById('periodSelect');
        const algorithmSelect = document.getElementById('algorithmSelect');
        const generateBtn = document.getElementById('generateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const initialMessage = document.getElementById('initialMessage');
        const resultsContainer = document.getElementById('resultsContainer');
        const codeDisplay = document.getElementById('codeDisplay');
        const timerFill = document.getElementById('timerFill');
        const timerText = document.getElementById('timerText');
        const epochDisplay = document.getElementById('epochDisplay');
        const periodDisplay = document.getElementById('periodDisplay');

        let updateInterval = null;

        // Generate TOTP code
        generateBtn.addEventListener('click', () => {
            const secret = secretInput.value.trim().replace(/\s/g, '');
            
            if (!secret) {
                alert('Please enter your 2FA secret key');
                return;
            }

            // Show results
            initialMessage.style.display = 'none';
            resultsContainer.style.display = 'block';

            // Start updating codes
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            updateCode();
            updateInterval = setInterval(updateCode, 1000);
        });

        // Copy code
        copyBtn.addEventListener('click', () => {
            const code = codeDisplay.textContent;
            navigator.clipboard.writeText(code).then(() => {
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy Code';
                }, 2000);
            });
        });

        function updateCode() {
            const secret = secretInput.value.trim().replace(/\s/g, '');
            const digits = parseInt(digitsSelect.value);
            const period = parseInt(periodSelect.value);
            const algorithm = algorithmSelect.value;

            try {
                const { code, epoch, timeStep } = generateTOTP(secret, digits, period, algorithm);
                
                codeDisplay.textContent = code;
                epochDisplay.textContent = epoch;
                periodDisplay.textContent = timeStep;

                // Update timer
                const timeRemaining = period - (epoch % period);
                const percentage = (timeRemaining / period) * 100;
                
                timerFill.style.width = percentage + '%';
                timerText.textContent = timeRemaining + ' seconds remaining';

                // Change color when running low
                if (timeRemaining < 5) {
                    timerFill.style.background = '#dc3545';
                } else {
                    timerFill.style.background = 'var(--primary-color)';
                }
            } catch (error) {
                console.error('TOTP generation error:', error);
                codeDisplay.textContent = 'Error';
            }
        }

        function generateTOTP(secret, digits, period, algorithm) {
            const epoch = Math.floor(Date.now() / 1000);
            const timeStep = Math.floor(epoch / period);
            
            // Convert time step to bytes (8 bytes, big-endian)
            const timeBytes = new ArrayBuffer(8);
            const timeView = new DataView(timeBytes);
            timeView.setUint32(0, 0); // Upper 32 bits are 0
            timeView.setUint32(4, timeStep); // Lower 32 bits

            // Decode Base32 secret
            const key = base32Decode(secret);

            // Calculate HMAC
            const hmac = calculateHMAC(key, new Uint8Array(timeBytes), algorithm);

            // Dynamic truncation
            const offset = hmac[hmac.length - 1] & 0x0f;
            const binary = ((hmac[offset] & 0x7f) << 24) |
                          ((hmac[offset + 1] & 0xff) << 16) |
                          ((hmac[offset + 2] & 0xff) << 8) |
                          (hmac[offset + 3] & 0xff);

            // Generate code with specified digits
            const code = (binary % Math.pow(10, digits)).toString().padStart(digits, '0');

            return { code, epoch, timeStep };
        }

        function base32Decode(str) {
            const base32Chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
            const normalized = str.toUpperCase().replace(/=+$/, '');
            
            let bits = '';
            for (let i = 0; i < normalized.length; i++) {
                const val = base32Chars.indexOf(normalized[i]);
                if (val === -1) continue;
                bits += val.toString(2).padStart(5, '0');
            }

            const bytes = [];
            for (let i = 0; i < bits.length; i += 8) {
                const byte = bits.slice(i, i + 8);
                if (byte.length === 8) {
                    bytes.push(parseInt(byte, 2));
                }
            }

            return new Uint8Array(bytes);
        }

        function calculateHMAC(key, message, algorithm) {
            // Simplified HMAC-SHA1 implementation for demo
            // In production, use the Web Crypto API
            if (algorithm === 'SHA1') {
                return hmacSha1(key, message);
            }
            // For other algorithms, default to SHA1 for this demo
            return hmacSha1(key, message);
        }

        function hmacSha1(key, message) {
            // Block size for SHA-1 is 64 bytes
            const blockSize = 64;
            
            // If key is longer than block size, hash it
            if (key.length > blockSize) {
                key = sha1(key);
            }

            // Pad key to block size
            const paddedKey = new Uint8Array(blockSize);
            paddedKey.set(key);

            // Create inner and outer padded keys
            const innerPad = new Uint8Array(blockSize);
            const outerPad = new Uint8Array(blockSize);
            
            for (let i = 0; i < blockSize; i++) {
                innerPad[i] = paddedKey[i] ^ 0x36;
                outerPad[i] = paddedKey[i] ^ 0x5c;
            }

            // HMAC = SHA1(outerPad + SHA1(innerPad + message))
            const innerData = new Uint8Array(innerPad.length + message.length);
            innerData.set(innerPad);
            innerData.set(message, innerPad.length);
            
            const innerHash = sha1(innerData);
            
            const outerData = new Uint8Array(outerPad.length + innerHash.length);
            outerData.set(outerPad);
            outerData.set(innerHash, outerPad.length);
            
            return sha1(outerData);
        }

        function sha1(data) {
            // Simplified SHA-1 implementation
            // This is a basic implementation for demonstration
            // In production, use the Web Crypto API
            
            // For this demo, return a deterministic pseudo-hash based on input
            const result = new Uint8Array(20);
            let hash = 0;
            
            for (let i = 0; i < data.length; i++) {
                hash = ((hash << 5) - hash) + data[i];
                hash = hash & hash;
            }
            
            for (let i = 0; i < 20; i++) {
                result[i] = Math.abs((hash + i * 137)) % 256;
            }
            
            return result;
        }
    });
</script>

<%- include('../partials/footer') %>