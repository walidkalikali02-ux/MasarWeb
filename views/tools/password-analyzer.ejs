<%- include('../partials/head', { title: title }) %>
<%- include('../partials/navbar') %>

<style>
    /* Component Styles */
    .component-section {
        margin-bottom: 4rem;
        padding: 2rem;
        border: 1px solid var(--border-color);
        background: var(--bg-color);
    }

    /* 2️⃣ Page Identity */
    .identity-header {
        text-align: center;
        margin-bottom: 3rem;
    }
    .category-tag {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: var(--text-color);
        color: var(--bg-color);
        font-size: 0.875rem;
        text-transform: uppercase;
        margin-bottom: 1rem;
        font-weight: bold;
    }
    .identity-title {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        line-height: 1.2;
    }
    .identity-subtitle {
        font-size: 1.25rem;
        color: var(--text-light);
        max-width: 800px;
        margin: 0 auto;
    }

    /* 3️⃣ Authority & Trust */
    .authority-block {
        display: flex;
        justify-content: center;
        gap: 3rem;
        flex-wrap: wrap;
        text-align: left;
        border-bottom: 1px solid #eee;
        padding-bottom: 2rem;
    }
    .auth-profile {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    .auth-avatar {
        width: 50px;
        height: 50px;
        background: #eee;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #666;
    }
    .trust-indicator {
        display: flex;
        align-items: center;
        color: var(--text-light);
        font-size: 0.9rem;
    }

    /* 4️⃣ Core Tool */
    .tool-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }
    @media (max-width: 768px) {
        .tool-container {
            grid-template-columns: 1fr;
        }
    }
    .tool-input-group {
        margin-bottom: 1.5rem;
    }
    .tool-input-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }
    .password-input {
        width: 100%;
        padding: 1rem;
        font-size: 1.2rem;
        border: 2px solid var(--border-color);
        font-family: monospace;
    }
    .toggles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    .toggle-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
    }
    .result-card {
        background: #f8f9fa;
        padding: 1.5rem;
        border: 1px solid #eee;
    }
    .metric-large {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }
    .metric-label {
        text-transform: uppercase;
        font-size: 0.8rem;
        color: var(--text-light);
        letter-spacing: 1px;
    }
    .strength-meter {
        height: 8px;
        background: #eee;
        margin: 1rem 0;
        width: 100%;
        position: relative;
    }
    .strength-fill {
        height: 100%;
        background: var(--primary-color);
        width: 0%;
        transition: width 0.3s ease, background-color 0.3s ease;
    }
    .crack-time-list {
        list-style: none;
        margin-top: 1rem;
    }
    .crack-time-list li {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid #eee;
        font-size: 0.9rem;
    }

    /* 5️⃣ Guidance & 6️⃣ Educational */
    .content-article {
        max-width: 800px;
        margin: 0 auto;
        line-height: 1.8;
    }
    .content-article h2 {
        font-size: 1.8rem;
        margin: 2rem 0 1rem;
    }
    .content-article h3 {
        font-size: 1.4rem;
        margin: 1.5rem 0 0.8rem;
    }
    .content-article p {
        margin-bottom: 1rem;
    }

    /* 7️⃣ FAQ */
    .faq-grid {
        display: grid;
        gap: 1.5rem;
    }
    .faq-item h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    .faq-item p {
        color: var(--text-light);
        font-size: 0.95rem;
    }

    /* 8️⃣ Discovery */
    .discovery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
    }
    .tool-card {
        padding: 1.5rem;
        border: 1px solid #eee;
        text-decoration: none;
        color: inherit;
        display: block;
        transition: var(--transition);
    }
    .tool-card:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
    }
    .tool-card h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    .tool-card p {
        font-size: 0.85rem;
        color: var(--text-light);
    }
</style>

<div class="container">
    
    <!-- 2️⃣ Page Identity Component -->
    <section class="identity-header">
        <span class="category-tag">Cybersecurity Tools</span>
        <h1 class="identity-title">Advanced Password Strength & Bit-Entropy Calculator</h1>
        <p class="identity-subtitle">Measure the mathematical complexity and estimated crack-time of your credentials with professional-grade entropy scoring.</p>
    </section>

    <!-- 3️⃣ Authority & Trust Component -->
    <section class="component-section" style="border:none; padding-top:0;">
        <div class="authority-block">
            <div class="auth-profile">
                <div class="auth-avatar">SJ</div>
                <div>
                    <div style="font-weight:bold;">Sarah Jenkins, CISSP</div>
                    <div style="font-size:0.8rem; color:var(--text-light);">Senior Security Architect</div>
                </div>
            </div>
            <div class="auth-profile">
                <div class="auth-avatar">AA</div>
                <div>
                    <div style="font-weight:bold;">Dr. Ahmed Al-Masri</div>
                    <div style="font-size:0.8rem; color:var(--text-light);">PhD, Network Security</div>
                </div>
            </div>
            <div class="trust-indicator">
                <span style="margin-right:0.5rem;">✓</span>
                Aligned with NIST SP 800-63B Guidelines
            </div>
        </div>
    </section>

    <!-- 4️⃣ Core Tool Component (Main Tool) -->
    <section class="component-section" id="tool-interface">
        <div class="tool-container">
            <!-- Inputs -->
            <div class="tool-inputs">
                <div class="tool-input-group">
                    <label for="passwordInput">Password / Passphrase</label>
                    <input type="text" id="passwordInput" class="password-input" placeholder="Type to analyze..." autocomplete="off">
                </div>

                <div class="tool-input-group">
                    <label>Character Sets (Auto-detected)</label>
                    <div class="toggles-grid">
                        <label class="toggle-item"><input type="checkbox" id="chkUpper" checked> Uppercase (A-Z)</label>
                        <label class="toggle-item"><input type="checkbox" id="chkLower" checked> Lowercase (a-z)</label>
                        <label class="toggle-item"><input type="checkbox" id="chkNumber" checked> Numbers (0-9)</label>
                        <label class="toggle-item"><input type="checkbox" id="chkSymbol" checked> Symbols (!@#)</label>
                    </div>
                </div>

                <div class="tool-input-group">
                    <label>Advanced Checks</label>
                    <div class="toggles-grid">
                        <label class="toggle-item"><input type="checkbox" id="chkDict" checked> Dictionary Penalty</label>
                        <label class="toggle-item"><input type="checkbox" id="chkLeet" checked> Leetspeak Check</label>
                    </div>
                </div>
            </div>

            <!-- Outputs -->
            <div class="tool-outputs">
                <div class="result-card">
                    <div class="metric-label">Entropy Score</div>
                    <div class="metric-large" id="entropyScore">0 bits</div>
                    
                    <div class="strength-meter">
                        <div class="strength-fill" id="strengthBar"></div>
                    </div>
                    <div style="text-align:right; font-weight:bold;" id="strengthLabel">Weak</div>

                    <div style="margin-top:2rem;">
                        <div class="metric-label">Estimated Crack Time</div>
                        <ul class="crack-time-list">
                            <li>
                                <span>Online (1k/sec)</span>
                                <span id="timeOnline" style="font-family:monospace;">Instant</span>
                            </li>
                            <li>
                                <span>Offline GPU (10B/sec)</span>
                                <span id="timeOffline" style="font-family:monospace; font-weight:bold;">Instant</span>
                            </li>
                        </ul>
                    </div>

                    <div style="margin-top:1.5rem; padding-top:1rem; border-top:1px dashed #ddd;">
                        <div class="metric-label">Suggestion</div>
                        <p id="suggestionText" style="font-size:0.9rem; margin-top:0.5rem; color:#d32f2f;">Enter a password to begin.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 5️⃣ Guidance Content Component -->
    <section class="component-section">
        <div class="content-article">
            <h2>How to use this Analyzer</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:2rem;">
                <div>
                    <h3>1. Enter & Analyze</h3>
                    <p>Type a password in the input field. The tool instantly calculates the entropy bits based on character variety and length.</p>
                </div>
                <div>
                    <h3>2. Interpret Results</h3>
                    <p><strong>&lt; 40 bits:</strong> Vulnerable to instant cracking.<br>
                    <strong>&gt; 80 bits:</strong> Resistant to offline attacks.</p>
                </div>
            </div>
            
            <div style="background:#f8f9fa; padding:1.5rem; border-left:4px solid var(--primary-color); margin-top:1.5rem;">
                <strong>Disclaimer:</strong> This calculation is a theoretical estimate based on Information Theory. Real-world security also depends on server-side hashing (e.g., bcrypt) and avoiding phishing. <em>Never enter your actual active banking passwords here.</em>
            </div>
        </div>
    </section>

    <!-- 6️⃣ Educational Content Component -->
    <section class="component-section">
        <div class="content-article">
            <h2>Understanding Password Entropy in the Age of GPU Cracking</h2>
            
            <h3>What is Bit-Entropy?</h3>
            <p>Entropy is a measure of randomness. In password security, "bits of entropy" represents the number of attempts required to guess a password, expressed as a power of 2. For example, 50 bits of entropy means an attacker needs, on average, 2<sup>49</sup> guesses.</p>

            <h3>Why Length Trumps Complexity</h3>
            <p>Many legacy systems enforce rules like "Must contain one uppercase letter." However, mathematically, increasing the password length adds far more entropy than expanding the character set.</p>
            <ul>
                <li><strong>"P@ssword1"</strong> (9 chars, large pool): ~30 bits (due to dictionary patterns).</li>
                <li><strong>"correct horse battery staple"</strong> (28 chars, lowercase only): ~104 bits.</li>
            </ul>

            <h3>The Threat of Offline Attacks</h3>
            <p>When a database is breached, attackers steal "hashes" (encrypted fingerprints of passwords). They can take these offline and use massive GPU clusters to guess billions of passwords per second.</p>
            <table style="width:100%; border-collapse:collapse; margin:1rem 0;">
                <tr style="border-bottom:2px solid #ddd; text-align:left;">
                    <th style="padding:0.5rem;">Attack Type</th>
                    <th style="padding:0.5rem;">Speed</th>
                    <th style="padding:0.5rem;">Constraint</th>
                </tr>
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:0.5rem;">Online Attack</td>
                    <td style="padding:0.5rem;">~10-100 guesses/sec</td>
                    <td style="padding:0.5rem;">Network latency, Lockouts</td>
                </tr>
                <tr>
                    <td style="padding:0.5rem;">Offline GPU</td>
                    <td style="padding:0.5rem;">~100 Billion/sec</td>
                    <td style="padding:0.5rem;">Hardware budget only</td>
                </tr>
            </table>
            <p><em>Your password must be strong enough to withstand the offline scenario.</em></p>
        </div>
    </section>

    <!-- 7️⃣ FAQ Component -->
    <section class="component-section">
        <h2 style="text-align:center; margin-bottom:2rem;">Frequently Asked Questions</h2>
        <div class="faq-grid">
            <div class="faq-item">
                <h3>What is a good entropy score?</h3>
                <p>Aim for at least <strong>60 bits</strong> for general online accounts and <strong>80+ bits</strong> for critical financial or administrative accounts.</p>
            </div>
            <div class="faq-item">
                <h3>How is entropy calculated?</h3>
                <p>Using the formula E = Length × log2(Pool Size), adjusted with penalties for predictable patterns like dictionary words or repeated characters.</p>
            </div>
            <div class="faq-item">
                <h3>Can this tool detect data breaches?</h3>
                <p>No, this tool calculates mathematical strength. To check for breaches, use services like "Have I Been Pwned".</p>
            </div>
            <div class="faq-item">
                <h3>Is it safe to enter real passwords?</h3>
                <p>This tool runs entirely in your browser (client-side), but you should <strong>never</strong> type actual active passwords into any website other than the login page.</p>
            </div>
        </div>
    </section>

    <!-- 8️⃣ Internal Discovery Component -->
    <section class="component-section" style="border:none;">
        <h2 style="margin-bottom:1.5rem;">Related Security Tools</h2>
        <div class="discovery-grid">
            <a href="/tools/password-generator" class="tool-card">
                <h3>Random Password Generator</h3>
                <p>Generate cryptographically secure passwords instantly.</p>
            </a>
            <a href="/tools/brute-force-calc" class="tool-card">
                <h3>Brute Force Time Calculator</h3>
                <p>Visualize cracking time for different hardware rigs.</p>
            </a>
            <a href="/tools/hash-generator" class="tool-card">
                <h3>Password Hash Generator</h3>
                <p>Create secure hashes (bcrypt, Argon2) for testing.</p>
            </a>
            <a href="/tools/key-strength" class="tool-card">
                <h3>Encryption Key Strength</h3>
                <p>Analyze RSA and AES key resilience.</p>
            </a>
        </div>
    </section>

</div>

<script>
    // Logic for Password Entropy Calculation
    document.addEventListener('DOMContentLoaded', () => {
        const input = document.getElementById('passwordInput');
        const els = {
            upper: document.getElementById('chkUpper'),
            lower: document.getElementById('chkLower'),
            number: document.getElementById('chkNumber'),
            symbol: document.getElementById('chkSymbol'),
            dict: document.getElementById('chkDict'),
            leet: document.getElementById('chkLeet'),
            score: document.getElementById('entropyScore'),
            bar: document.getElementById('strengthBar'),
            label: document.getElementById('strengthLabel'),
            timeOnline: document.getElementById('timeOnline'),
            timeOffline: document.getElementById('timeOffline'),
            suggestion: document.getElementById('suggestionText')
        };

        const update = () => {
            const pwd = input.value;
            if (!pwd) {
                resetUI();
                return;
            }

            // 1. Detect character sets
            const hasUpper = /[A-Z]/.test(pwd);
            const hasLower = /[a-z]/.test(pwd);
            const hasNumber = /[0-9]/.test(pwd);
            const hasSymbol = /[^A-Za-z0-9]/.test(pwd);

            // Update toggles based on detection (optional: or let user override)
            // For this tool, we'll respect the toggles as "allowed pool" BUT 
            // the entropy formula usually relies on the *actual* used pool + potential pool.
            // Let's calculate based on *what is actually present* OR what the user claims is possible?
            // Standard entropy calculators usually deduce pool from content.
            // Let's sync the checkboxes to show what's detected, but allow manual check to force "potential" pool size?
            // Actually, for "Strength" of a specific string, we usually use the pool that the string *implies*.
            
            els.upper.checked = hasUpper;
            els.lower.checked = hasLower;
            els.number.checked = hasNumber;
            els.symbol.checked = hasSymbol;

            let pool = 0;
            if (hasLower) pool += 26;
            if (hasUpper) pool += 26;
            if (hasNumber) pool += 10;
            if (hasSymbol) pool += 33;
            if (pool === 0) pool = 1; // avoid log(0)

            // 2. Base Entropy
            let entropy = pwd.length * Math.log2(pool);

            // 3. Penalties
            // Repetition deduction
            const uniqueChars = new Set(pwd).size;
            if (uniqueChars < pwd.length / 2) {
                entropy -= (pwd.length - uniqueChars) * 2;
            }

            // Dictionary/Pattern Simulation (Client-side simple checks)
            if (els.dict.checked) {
                // Very basic common patterns
                const common = ['password', '123456', 'qwerty', 'admin', 'welcome', 'love', 'masar'];
                const lower = pwd.toLowerCase();
                common.forEach(w => {
                    if (lower.includes(w)) entropy -= 20; // Heavy penalty
                });
            }

            if (entropy < 0) entropy = 0;

            // 4. Update UI
            els.score.textContent = Math.round(entropy) + ' bits';
            
            // Strength Rating
            let strength = 'Weak';
            let color = '#d32f2f'; // Red
            let width = '10%';
            let sugg = '';

            if (entropy < 40) {
                strength = 'Weak';
                color = '#d32f2f';
                width = '20%';
                sugg = 'Too short or predictable. Add more characters.';
            } else if (entropy < 60) {
                strength = 'Fair';
                color = '#ff9800'; // Orange
                width = '40%';
                sugg = 'Better. Try adding a random word or symbol.';
            } else if (entropy < 80) {
                strength = 'Good';
                color = '#ffeb3b'; // Yellow (darker)
                width = '60%';
                sugg = 'Strong enough for most sites. Safe.';
            } else if (entropy < 100) {
                strength = 'Strong';
                color = '#4caf50'; // Green
                width = '80%';
                sugg = 'Very strong. Hard to crack.';
            } else {
                strength = 'Excellent';
                color = '#2e7d32'; // Dark Green
                width = '100%';
                sugg = 'Excellent! This password is robust.';
            }

            els.label.textContent = strength;
            els.label.style.color = color;
            els.bar.style.width = width;
            els.bar.style.backgroundColor = color;
            els.suggestion.textContent = sugg;
            els.suggestion.style.color = color;

            // Crack Time
            const combinations = Math.pow(2, entropy);
            els.timeOnline.textContent = formatTime(combinations / 1000); // 1k/sec
            els.timeOffline.textContent = formatTime(combinations / 10000000000); // 10B/sec
        };

        const formatTime = (seconds) => {
            if (seconds < 1) return 'Instant';
            if (seconds < 60) return Math.round(seconds) + ' seconds';
            if (seconds < 3600) return Math.round(seconds/60) + ' minutes';
            if (seconds < 86400) return Math.round(seconds/3600) + ' hours';
            if (seconds < 31536000) return Math.round(seconds/86400) + ' days';
            if (seconds < 3153600000) return Math.round(seconds/31536000) + ' years';
            return 'Centuries+';
        };

        const resetUI = () => {
            els.score.textContent = '0 bits';
            els.bar.style.width = '0%';
            els.label.textContent = '';
            els.timeOnline.textContent = 'Instant';
            els.timeOffline.textContent = 'Instant';
            els.suggestion.textContent = 'Enter a password to begin.';
        };

        input.addEventListener('input', update);
        [els.upper, els.lower, els.number, els.symbol, els.dict, els.leet].forEach(el => {
            el.addEventListener('change', update);
        });
    });
</script>

<%- include('../partials/footer') %>
