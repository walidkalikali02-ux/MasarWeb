<!DOCTYPE html>
<html lang="<%= currentLang %>" dir="<%= dir %>">
<%- include('../partials/head', { pageTitle: title }) %>
<body>
    <%- include('../partials/navbar') %>

    <main class="main-content">
        <style>
            :root {
                --primary-color: #0056b3;
                --secondary-color: #6c757d;
                --success-color: #28a745;
                --warning-color: #ffc107;
                --danger-color: #dc3545;
                --bg-color: #f8f9fa;
                --card-bg: #ffffff;
                --border-color: #dee2e6;
                --text-main: #212529;
                --text-light: #6c757d;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 2rem 1rem;
            }

            /* 2️⃣ Page Identity */
            .identity-header {
                text-align: center;
                margin-bottom: 3rem;
            }
            .category-tag {
                display: inline-block;
                background: #e9ecef;
                color: var(--text-light);
                padding: 0.25rem 0.75rem;
                border-radius: 20px;
                font-size: 0.85rem;
                margin-bottom: 1rem;
                font-weight: 600;
            }
            .identity-title {
                font-size: 2.5rem;
                color: var(--text-main);
                margin-bottom: 1rem;
                line-height: 1.2;
            }
            .identity-subtitle {
                font-size: 1.2rem;
                color: var(--text-light);
                max-width: 800px;
                margin: 0 auto;
            }

            /* 3️⃣ Authority & Trust */
            .authority-block {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 2rem;
                margin-bottom: 3rem;
                flex-wrap: wrap;
                background: var(--card-bg);
                padding: 1rem;
                border-radius: 12px;
                border: 1px solid var(--border-color);
            }
            .auth-profile {
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }
            .auth-avatar {
                width: 40px;
                height: 40px;
                background: var(--primary-color);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                color: white;
                font-size: 1.2rem;
            }
            .auth-info h4 {
                font-size: 0.95rem;
                margin: 0;
            }
            .auth-info p {
                font-size: 0.8rem;
                color: var(--text-light);
                margin: 0;
            }
            .trust-indicator {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: var(--success-color);
                font-weight: 500;
                font-size: 0.9rem;
                background: #f0f9f0;
                padding: 0.5rem 1rem;
                border-radius: 20px;
            }

            /* 4️⃣ Core Tool */
            .tool-layout {
                display: grid;
                grid-template-columns: 350px 1fr;
                gap: 2rem;
                margin-bottom: 4rem;
                align-items: start;
            }
            @media (max-width: 900px) {
                .tool-layout {
                    grid-template-columns: 1fr;
                }
            }

            /* Input Section */
            .tool-controls {
                background: var(--card-bg);
                padding: 1.5rem;
                border-radius: 12px;
                border: 1px solid var(--border-color);
                box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            }
            .input-group {
                margin-bottom: 1.5rem;
            }
            .input-group label {
                display: block;
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: var(--text-main);
            }
            .input-control {
                width: 100%;
                padding: 0.75rem;
                border: 1px solid var(--border-color);
                border-radius: 6px;
                font-size: 1rem;
                transition: border-color 0.2s;
            }
            .input-control:focus {
                outline: none;
                border-color: var(--primary-color);
            }
            textarea.input-control {
                min-height: 100px;
                resize: vertical;
            }

            /* Output Section */
            .tool-results {
                display: grid;
                gap: 1.5rem;
            }
            .result-card {
                background: var(--card-bg);
                border-radius: 12px;
                border: 1px solid var(--border-color);
                padding: 1.5rem;
            }
            .result-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
                border-bottom: 1px solid #eee;
                padding-bottom: 0.75rem;
            }
            .result-title {
                font-weight: 700;
                font-size: 1.1rem;
            }

            /* Matrix */
            .permission-matrix {
                width: 100%;
                border-collapse: collapse;
                font-size: 0.9rem;
            }
            .permission-matrix th, .permission-matrix td {
                padding: 0.75rem;
                border: 1px solid #eee;
                text-align: center;
            }
            .permission-matrix th {
                background: #f8f9fa;
                font-weight: 600;
            }
            .role-badge {
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            .role-owner { background: #ffeeba; color: #856404; }
            .role-admin { background: #f8d7da; color: #721c24; }
            .role-editor { background: #d1ecf1; color: #0c5460; }
            .role-viewer { background: #d4edda; color: #155724; }

            /* DB Visualization */
            .json-view {
                background: #2d2d2d;
                color: #ccc;
                padding: 1rem;
                border-radius: 6px;
                font-family: monospace;
                font-size: 0.85rem;
                overflow-x: auto;
                white-space: pre;
            }
            .json-key { color: #9cdcfe; }
            .json-string { color: #ce9178; }
            .json-number { color: #b5cea8; }

            /* Score Gauge */
            .score-container {
                text-align: center;
            }
            .score-value {
                font-size: 3rem;
                font-weight: 800;
                color: var(--primary-color);
            }
            .score-label {
                color: var(--text-light);
                font-size: 0.9rem;
            }

            /* Audit Log */
            .audit-list {
                list-style: none;
                padding: 0;
                margin: 0;
                max-height: 200px;
                overflow-y: auto;
            }
            .audit-item {
                padding: 0.5rem;
                border-bottom: 1px solid #eee;
                font-size: 0.85rem;
                display: flex;
                justify-content: space-between;
            }
            .audit-time { color: var(--text-light); font-size: 0.75rem; }

            /* 5️⃣ & 6️⃣ Content Sections */
            .content-section {
                max-width: 800px;
                margin: 0 auto 3rem;
                background: var(--card-bg);
                padding: 2.5rem;
                border-radius: 12px;
                border: 1px solid var(--border-color);
            }
            .content-section h2 {
                font-size: 1.8rem;
                margin-bottom: 1.5rem;
                color: var(--text-main);
            }
            .content-section h3 {
                font-size: 1.4rem;
                margin: 1.5rem 0 1rem;
                color: var(--text-main);
            }
            .content-section p {
                line-height: 1.7;
                color: #495057;
                margin-bottom: 1.5rem;
            }
            .content-section ul {
                padding-left: 1.5rem;
                margin-bottom: 1.5rem;
            }
            .content-section li {
                margin-bottom: 0.5rem;
                line-height: 1.6;
            }

            /* 7️⃣ FAQ */
            .faq-grid {
                display: grid;
                gap: 1rem;
                max-width: 800px;
                margin: 0 auto 3rem;
            }
            .faq-item {
                background: var(--card-bg);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 1.5rem;
            }
            .faq-item h3 {
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
                color: var(--text-main);
            }
            .faq-item p {
                margin: 0;
                color: var(--text-light);
                font-size: 0.95rem;
            }

            /* 8️⃣ Internal Discovery */
            .discovery-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin-top: 1rem;
            }
            .discovery-card {
                background: var(--card-bg);
                padding: 1.5rem;
                border-radius: 12px;
                border: 1px solid var(--border-color);
                text-decoration: none;
                color: inherit;
                transition: transform 0.2s, box-shadow 0.2s;
            }
            .discovery-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.05);
                border-color: var(--primary-color);
            }
            .discovery-card h4 {
                margin: 0 0 0.5rem;
                color: var(--primary-color);
            }
            .discovery-card p {
                margin: 0;
                font-size: 0.9rem;
                color: var(--text-light);
            }
        </style>

        <div class="container">
            
            <!-- 2️⃣ Page Identity Component -->
            <section class="identity-header">
                <span class="category-tag">Cybersecurity & Business Operations</span>
                <h1 class="identity-title">Shared Password Vault for Small Teams and Startups</h1>
                <p class="identity-subtitle">The ultimate secure hub for managing team-wide access to shared accounts and sensitive credentials.</p>
            </section>

            <!-- 3️⃣ Authority & Trust Component -->
            <section class="authority-block">
                <div class="auth-profile">
                    <div class="auth-avatar">LF</div>
                    <div class="auth-info">
                        <h4>Dr. Lena Farouk</h4>
                        <p>PhD Information Security, CISSP</p>
                    </div>
                </div>
                <div class="auth-profile">
                    <div class="auth-avatar" style="background: var(--secondary-color);">MA</div>
                    <div class="auth-info">
                        <h4>Miguel Alvarez</h4>
                        <p>Principal DevSecOps, ISO 27001 Lead</p>
                    </div>
                </div>
                <div class="trust-indicator">
                    <span>✓</span> Scientifically reviewed & NIST SP 800-63B aligned
                </div>
            </section>

            <!-- 4️⃣ Core Tool Component -->
            <section class="tool-layout">
                <!-- Inputs -->
                <div class="tool-controls">
                    <div class="input-group">
                        <label for="teamMembers">Number of Team Members</label>
                        <input type="number" id="teamMembers" class="input-control" value="5" min="1" max="50">
                    </div>
                    
                    <div class="input-group">
                        <label for="sharedServices">Shared Services (Comma separated)</label>
                        <textarea id="sharedServices" class="input-control">AWS Root, Stripe Dashboard, Twitter Corporate, GitHub Org, Slack Admin</textarea>
                    </div>

                    <div class="input-group">
                        <label for="encryptionAlgo">Encryption Standard</label>
                        <select id="encryptionAlgo" class="input-control">
                            <option value="AES-256-GCM">AES-256-GCM (Standard)</option>
                            <option value="ChaCha20-Poly1305">ChaCha20-Poly1305 (Mobile Optimized)</option>
                            <option value="RSA-OAEP">RSA-OAEP (Legacy)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Default Access Policy</label>
                        <select id="defaultRole" class="input-control">
                            <option value="Viewer">Least Privilege (Viewer)</option>
                            <option value="Editor">Collaborative (Editor)</option>
                            <option value="Admin">Open (Admin)</option>
                        </select>
                    </div>
                </div>

                <!-- Outputs -->
                <div class="tool-results">
                    <!-- Score -->
                    <div class="result-card" style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div class="result-title">Vault Security Score</div>
                            <div style="font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem;">Based on role granularity & encryption</div>
                        </div>
                        <div class="score-container">
                            <div id="securityScore" class="score-value">85</div>
                            <div class="score-label">OUT OF 100</div>
                        </div>
                    </div>

                    <!-- Matrix -->
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">User Access Permission Matrix</div>
                            <small class="text-muted">Generated based on team size & services</small>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="permission-matrix" id="permissionMatrix">
                                <!-- Populated by JS -->
                            </table>
                        </div>
                    </div>

                    <!-- DB Visualization -->
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">Encrypted Storage Schema (Preview)</div>
                            <small class="text-muted">How data is stored on disk</small>
                        </div>
                        <div class="json-view" id="dbSchema">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Audit Log -->
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">Activity Audit Trail (Live Simulation)</div>
                        </div>
                        <ul class="audit-list" id="auditLog">
                            <!-- Populated by JS -->
                        </ul>
                    </div>
                </div>
            </section>

            <!-- 5️⃣ Guidance Content Component -->
            <section class="content-section">
                <h2>How to use Team Password Vault</h2>
                <ol>
                    <li><strong>Define Team Size</strong>: Enter the number of employees requiring access (1-50).</li>
                    <li><strong>List Services</strong>: Add all critical accounts (SaaS, Cloud, Social) separated by commas.</li>
                    <li><strong>Configure Access</strong>: Select a default policy. "Least Privilege" is recommended for highest security.</li>
                    <li><strong>Select Encryption</strong>: Choose AES-256-GCM for standard compliance or ChaCha20 for mobile performance.</li>
                </ol>

                <h3>How the Calculation Works</h3>
                <p>The system generates a <strong>Role-Based Access Control (RBAC)</strong> model. It maps Users to Resources via Permissions. The <strong>Security Score</strong> is calculated by penalizing over-privileged accounts (e.g., too many Admins) and rewarding strong encryption and segregation of duties.</p>

                <h3>How to Interpret Results</h3>
                <ul>
                    <li><strong>Permission Matrix</strong>: Green cells indicate safe access; Red/Yellow cells warn of potential privilege escalation risks.</li>
                    <li><strong>Health Score</strong>:
                        <ul>
                            <li><strong>90-100</strong>: Excellent Role Segregation.</li>
                            <li><strong>70-89</strong>: Good, but review Admin counts.</li>
                            <li><strong>&lt;70</strong>: Critical Risk - Too many users have unrestricted access.</li>
                        </ul>
                    </li>
                </ul>

                <p><em><strong>Disclaimer:</strong> This tool provides a structural simulation of a secure vault architecture. Actual security depends on implementation details, key management practices, and operational discipline. Not a replacement for a certified enterprise password manager.</em></p>
            </section>

            <!-- 6️⃣ Educational Content Component -->
            <section class="content-section">
                <h2>Implementing Secure Credential Management for Growing Teams</h2>
                <p>Managing shared secrets is one of the most critical challenges for startups and small businesses. As teams grow, the "spreadsheet method" becomes a liability. This guide explores the architecture of secure, shared vaults.</p>

                <h3>The Mathematical Foundation of Shared Vaults</h3>
                <p>At the core of any team password manager is <strong>Public Key Cryptography</strong>. Unlike personal vaults that use a single symmetric key, team vaults often employ a hybrid approach:</p>
                <ul>
                    <li><strong>Symmetric Encryption (AES-256)</strong>: Used to encrypt the actual password data (the "payload") because it is fast and efficient.</li>
                    <li><strong>Asymmetric Encryption (RSA/ECC)</strong>: Used to share the symmetric key. Each team member has a Public/Private key pair. The payload's symmetric key is encrypted with the Public Key of every user authorized to access it.</li>
                </ul>

                <h3>The Problem with "Shared" Passwords</h3>
                <p>When a password is shared via Slack or Email:</p>
                <ol>
                    <li><strong>Persistence</strong>: It remains in chat logs indefinitely.</li>
                    <li><strong>No Revocation</strong>: You cannot "un-send" it once seen.</li>
                    <li><strong>Lack of Attribution</strong>: If the account is compromised, you cannot prove <em>who</em> leaked it.</li>
                </ol>

                <h3>Role-Based Access Control (RBAC) in Vaults</h3>
                <p>RBAC replaces "all-or-nothing" access with granular permissions.</p>
                <table class="permission-matrix" style="margin-bottom: 1.5rem;">
                    <tr>
                        <th>Role</th>
                        <th>Capabilities</th>
                        <th>Typical Use Case</th>
                    </tr>
                    <tr>
                        <td><strong>Viewer</strong></td>
                        <td>Read-only access. Cannot copy/reveal.</td>
                        <td>Social Media Interns</td>
                    </tr>
                    <tr>
                        <td><strong>Operator</strong></td>
                        <td>Can use credentials (auto-fill) but no view.</td>
                        <td>Support Staff</td>
                    </tr>
                    <tr>
                        <td><strong>Editor</strong></td>
                        <td>Can update passwords and modify entries.</td>
                        <td>Team Leads</td>
                    </tr>
                    <tr>
                        <td><strong>Owner</strong></td>
                        <td>Full control, revocation, and deletion.</td>
                        <td>CTO / Founders</td>
                    </tr>
                </table>
                <p>Implementing RBAC ensures <strong>Least Privilege</strong>: users have only the access necessary to perform their job functions, reducing the attack surface.</p>

                <h3>Audit Trails: The Immutable Ledger</h3>
                <p>A secure vault does not just store secrets; it records <em>access</em>. An effective audit trail answers <strong>Who</strong> accessed <strong>What</strong> and <strong>When</strong>. In the event of a breach, forensic analysts use these logs to trace the point of compromise.</p>
            </section>

            <!-- 7️⃣ FAQ Component -->
            <section class="content-section" style="background: transparent; border: none; padding: 0;">
                <h2 style="text-align: center; margin-bottom: 2rem;">Frequently Asked Questions</h2>
                <div class="faq-grid">
                    <div class="faq-item">
                        <h3>How can a small team safely share passwords?</h3>
                        <p>Use a dedicated password manager that supports "Zero-Knowledge" encryption and organization-level sharing. Avoid text files, spreadsheets, or chat apps, as these methods lack encryption and audit logs.</p>
                    </div>
                    <div class="faq-item">
                        <h3>What are the benefits of a shared password vault over spreadsheets?</h3>
                        <p>Vaults offer encryption at rest, automated access revocation, detailed audit logs, and granular permission settings. Spreadsheets are easily copied, lack version control, and expose all data to anyone with the file.</p>
                    </div>
                    <div class="faq-item">
                        <h3>How does role-based access control work in a team vault?</h3>
                        <p>RBAC assigns permissions (like Read-Only, Edit, or Admin) to specific users for specific items. This ensures that a marketing intern cannot access or modify the production server database credentials.</p>
                    </div>
                    <div class="faq-item">
                        <h3>Is multi-factor authentication (MFA) necessary for a shared vault?</h3>
                        <p>Yes, absolutely. MFA is the single most effective defense against credential theft. It ensures that even if a master password is compromised, the vault remains inaccessible without the second factor.</p>
                    </div>
                    <div class="faq-item">
                        <h3>How can I revoke access to a shared password when an employee leaves?</h3>
                        <p>In a shared vault, you simply remove the user from the organization. The system immediately revokes their ability to decrypt shared keys. For high-security items, it is best practice to also rotate (change) the password itself.</p>
                    </div>
                </div>
            </section>

            <!-- 8️⃣ Internal Discovery Component -->
            <section class="content-section" style="background: transparent; border: none; padding: 0;">
                <h2 style="text-align: center;">Explore More Security Tools</h2>
                <div class="discovery-grid">
                    <a href="/tools/password-generator" class="discovery-card">
                        <h4>Strong Password Generator</h4>
                        <p>Generate cryptographically strong, random passwords instantly.</p>
                    </a>
                    <a href="/tools/breach-checker" class="discovery-card">
                        <h4>Credential Exposure Checker</h4>
                        <p>Check if your email or passwords have appeared in known data breaches.</p>
                    </a>
                    <a href="#" class="discovery-card">
                        <h4>Two-Factor Auth Setup Guide</h4>
                        <p>Learn how to enable and manage 2FA for your team's critical accounts.</p>
                    </a>
                    <a href="#" class="discovery-card">
                        <h4>Business Security Audit</h4>
                        <p>A comprehensive checklist to evaluate your organization's security posture.</p>
                    </a>
                </div>
            </section>

        </div>
    </main>

    <%- include('../partials/footer') %>

    <script>
        // Core Tool Logic
        document.addEventListener('DOMContentLoaded', () => {
            const teamInput = document.getElementById('teamMembers');
            const servicesInput = document.getElementById('sharedServices');
            const encryptionInput = document.getElementById('encryptionAlgo');
            const roleInput = document.getElementById('defaultRole');
            
            const matrixEl = document.getElementById('permissionMatrix');
            const schemaEl = document.getElementById('dbSchema');
            const logEl = document.getElementById('auditLog');
            const scoreEl = document.getElementById('securityScore');

            function updateTool() {
                const teamSize = parseInt(teamInput.value) || 1;
                const services = servicesInput.value.split(',').map(s => s.trim()).filter(s => s);
                const algo = encryptionInput.value;
                const defaultRole = roleInput.value;

                // 1. Generate Matrix
                renderMatrix(teamSize, services, defaultRole);

                // 2. Generate Schema
                renderSchema(services[0] || 'Service', algo, teamSize);

                // 3. Generate Audit Log
                renderAuditLog(teamSize, services);

                // 4. Calculate Score
                calculateScore(teamSize, services, defaultRole, algo);
            }

            function renderMatrix(teamSize, services, defaultRole) {
                if (services.length === 0) {
                    matrixEl.innerHTML = '<tr><td colspan="100%">No services defined</td></tr>';
                    return;
                }

                let html = '<thead><tr><th>User</th>';
                services.forEach(s => html += `<th>${s}</th>`);
                html += '</tr></thead><tbody>';

                const roles = ['Viewer', 'Editor', 'Admin', 'Owner'];

                for (let i = 1; i <= Math.min(teamSize, 8); i++) { // Limit display to 8 users for UI
                    html += `<tr><td><strong>User ${i}</strong>${i===1 ? ' (You)' : ''}</td>`;
                    services.forEach(s => {
                        // Simulation: User 1 is Owner, others vary based on defaultRole
                        let role = defaultRole;
                        if (i === 1) role = 'Owner';
                        else if (Math.random() > 0.8) role = roles[Math.floor(Math.random() * roles.length)]; // Random variance
                        
                        let badgeClass = 'role-' + role.toLowerCase();
                        html += `<td><span class="role-badge ${badgeClass}">${role}</span></td>`;
                    });
                    html += '</tr>';
                }
                
                if (teamSize > 8) {
                    html += `<tr><td colspan="${services.length + 1}">... and ${teamSize - 8} more users</td></tr>`;
                }

                html += '</tbody>';
                matrixEl.innerHTML = html;
            }

            function renderSchema(serviceName, algo, teamSize) {
                const schema = {
                    "record_id": "uuid-v4-hash-example",
                    "service_name": serviceName,
                    "encryption_meta": {
                        "algorithm": algo,
                        "iv": "base64_encoded_initialization_vector",
                        "tag_length": 128
                    },
                    "encrypted_payload": "a8f9c2d... (AES encrypted password data)",
                    "key_wrapping": {
                        "mode": "RSA-OAEP-256",
                        "recipient_keys": []
                    },
                    "access_policy": {
                        "min_role": "Viewer",
                        "requires_mfa": true
                    }
                };

                // Add mock recipients
                for(let i=0; i<Math.min(teamSize, 3); i++) {
                    schema.key_wrapping.recipient_keys.push({
                        "user_id": `user_00${i+1}`,
                        "wrapped_dek": `encrypted_dek_for_user_${i+1}...`
                    });
                }
                if(teamSize > 3) {
                    schema.key_wrapping.recipient_keys.push(`... ${teamSize-3} more keys`);
                }

                // Syntax highlighting logic
                const jsonStr = JSON.stringify(schema, null, 2);
                const highlighted = jsonStr.replace(/(".*?")(?=:)/g, '<span class="json-key">$1</span>')
                                         .replace(/: ("(.*?)")/g, ': <span class="json-string">"$2"</span>')
                                         .replace(/: (\d+)/g, ': <span class="json-number">$1</span>');
                
                schemaEl.innerHTML = highlighted;
            }

            function renderAuditLog(teamSize, services) {
                const actions = ['DECRYPT_PASSWORD', 'UPDATE_CREDENTIAL', 'GRANT_ACCESS', 'REVOKE_ACCESS', 'EXPORT_VAULT'];
                let html = '';
                
                // Generate 5 random events
                for(let i=0; i<5; i++) {
                    const time = new Date(Date.now() - Math.floor(Math.random() * 10000000)).toLocaleString();
                    const user = `User ${Math.floor(Math.random() * Math.min(teamSize, 10)) + 1}`;
                    const action = actions[Math.floor(Math.random() * actions.length)];
                    const service = services[Math.floor(Math.random() * services.length)];
                    
                    html += `
                        <li class="audit-item">
                            <div>
                                <strong>${user}</strong> performed <code>${action}</code> on <em>${service || 'System'}</em>
                            </div>
                            <div class="audit-time">${time}</div>
                        </li>
                    `;
                }
                logEl.innerHTML = html;
            }

            function calculateScore(teamSize, services, defaultRole, algo) {
                let score = 100;

                // Penalize for insecure algorithms
                if (algo === 'RSA-OAEP') score -= 10; // Legacy

                // Penalize for loose default permissions
                if (defaultRole === 'Admin') score -= 30;
                if (defaultRole === 'Editor') score -= 15;

                // Penalize for large teams with simple structure
                if (teamSize > 20 && defaultRole !== 'Viewer') score -= 10;

                // Penalize for too few services (just logic check)
                if (services.length < 1) score = 0;

                // Clamp
                score = Math.max(0, Math.min(100, score));

                scoreEl.innerText = score;
                
                // Color coding
                if (score >= 90) scoreEl.style.color = 'var(--success-color)';
                else if (score >= 70) scoreEl.style.color = 'var(--warning-color)';
                else scoreEl.style.color = 'var(--danger-color)';
            }

            // Listeners
            [teamInput, servicesInput, encryptionInput, roleInput].forEach(el => {
                el.addEventListener('input', updateTool);
                el.addEventListener('change', updateTool);
            });

            // Initial call
            updateTool();
        });
    </script>
</body>
</html>
